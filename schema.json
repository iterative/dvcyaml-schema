{
  "title": "dvc.yaml",
  "type": "object",
  "properties": {
    "vars": {
      "title": "Variables",
      "description": "Sequence of variables for parametrization.\n\nMay include any mapping or a path to a params file (which may be a string or a mapping to params in the file).\n\nUse elsewhere in `dvc.yaml` with the `${}` substitution expression.",
      "allOf": [
        {
          "$ref": "#/definitions/Vars"
        }
      ]
    },
    "stages": {
      "title": "Stages",
      "description": "Sequence of stages that form a pipeline.",
      "type": "object",
      "additionalProperties": {
        "oneOf": [
          {
            "$ref": "#/definitions/ForeachDo"
          },
          {
            "$ref": "#/definitions/Stage"
          }
        ]
      }
    }
  },
  "additionalProperties": false,
  "definitions": {
    "VarPath": {
      "title": "VarPath",
      "description": "Path to params file for parametrization.",
      "type": "string"
    },
    "VarDecl": {
      "title": "VarDecl",
      "description": "Mapping for parametrization.",
      "type": "object"
    },
    "Vars": {
      "title": "Vars",
      "type": "array",
      "items": {
        "anyOf": [
          {
            "$ref": "#/definitions/VarPath"
          },
          {
            "$ref": "#/definitions/VarDecl"
          }
        ]
      }
    },
    "DepModel": {
      "title": "DepModel",
      "description": "Path to a dependency file or dir for the stage",
      "type": "string"
    },
    "Dependencies": {
      "title": "Dependencies",
      "type": "array",
      "items": {
        "$ref": "#/definitions/DepModel"
      },
      "uniqueItems": true
    },
    "ParamKey": {
      "title": "ParamKey",
      "desc": "Parameter key (dot-separated).",
      "type": "string"
    },
    "CustomParamFileKeys": {
      "title": "CustomParamFileKeys",
      "desc": "Path to YAML/JSON/TOML/Python params file.",
      "type": "object",
      "additionalProperties": {
        "type": "array",
        "items": {
          "$ref": "#/definitions/ParamKey"
        },
        "uniqueItems": true
      }
    },
    "EmptyParamFileKeys": {
      "title": "EmptyParamFileKeys",
      "desc": "Path to YAML/JSON/TOML/Python params file.",
      "type": "object",
      "additionalProperties": {
        "type": "null"
      }
    },
    "Param": {
      "title": "Param",
      "anyOf": [
        {
          "$ref": "#/definitions/ParamKey"
        },
        {
          "$ref": "#/definitions/CustomParamFileKeys"
        },
        {
          "$ref": "#/definitions/EmptyParamFileKeys"
        }
      ]
    },
    "Params": {
      "title": "Params",
      "type": "array",
      "items": {
        "$ref": "#/definitions/Param"
      },
      "uniqueItems": true
    },
    "OutFlags": {
      "title": "OutFlags",
      "type": "object",
      "properties": {
        "cache": {
          "title": "Cache",
          "description": "Cache output by DVC",
          "default": true,
          "type": "boolean"
        },
        "persist": {
          "title": "Persist",
          "description": "Persist output between runs",
          "default": false,
          "type": "boolean"
        },
        "checkpoint": {
          "title": "Checkpoint",
          "description": "Indicate that the output is associated with in-code checkpoints",
          "default": false,
          "type": "boolean"
        },
        "desc": {
          "title": "Description",
          "description": "User description for the output",
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "Out": {
      "title": "Out",
      "description": "Path to an output file or dir of the stage.",
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/OutFlags"
          }
        }
      ]
    },
    "Outs": {
      "title": "Outs",
      "type": "array",
      "items": {
        "$ref": "#/definitions/Out"
      },
      "uniqueItems": true
    },
    "PlotFlags": {
      "title": "PlotFlags",
      "type": "object",
      "properties": {
        "cache": {
          "title": "Cache",
          "description": "Cache output by DVC",
          "default": true,
          "type": "boolean"
        },
        "persist": {
          "title": "Persist",
          "description": "Persist output between runs",
          "default": false,
          "type": "boolean"
        },
        "checkpoint": {
          "title": "Checkpoint",
          "description": "Indicate that the output is associated with in-code checkpoints",
          "default": false,
          "type": "boolean"
        },
        "desc": {
          "title": "Description",
          "description": "User description for the output",
          "type": "string"
        },
        "x": {
          "title": "X",
          "description": "Default field name to use as x-axis data",
          "type": "string"
        },
        "y": {
          "title": "Y",
          "description": "Default field name to use as y-axis data",
          "type": "string"
        },
        "x_label": {
          "title": "X Label",
          "description": "Default label for the x-axis",
          "type": "string"
        },
        "y_label": {
          "title": "Y Label",
          "description": "Default label for the y-axis",
          "type": "string"
        },
        "title": {
          "title": "Title",
          "description": "Default plot title",
          "type": "string"
        },
        "header": {
          "title": "Header",
          "description": "Whether the target CSV or TSV has a header or not",
          "default": false,
          "type": "boolean"
        },
        "template": {
          "title": "Template",
          "description": "Default plot template",
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "Plot": {
      "title": "Plot",
      "description": "Path to plots file or dir of the stage.\n\nData files may be JSON/YAML/CSV/TSV.\n\nImage files may be JPEG/GIF/PNG.",
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/PlotFlags"
          }
        }
      ]
    },
    "Plots": {
      "title": "Plots",
      "type": "array",
      "items": {
        "$ref": "#/definitions/Plot"
      },
      "uniqueItems": true
    },
    "LiveFlags": {
      "title": "LiveFlags",
      "type": "object",
      "properties": {
        "cache": {
          "title": "Cache",
          "description": "Cache output by DVC",
          "default": true,
          "type": "boolean"
        },
        "persist": {
          "title": "Persist",
          "description": "Persist output between runs",
          "default": false,
          "type": "boolean"
        },
        "checkpoint": {
          "title": "Checkpoint",
          "description": "Indicate that the output is associated with in-code checkpoints",
          "default": false,
          "type": "boolean"
        },
        "desc": {
          "title": "Description",
          "description": "User description for the output",
          "type": "string"
        },
        "x": {
          "title": "X",
          "description": "Default field name to use as x-axis data",
          "type": "string"
        },
        "y": {
          "title": "Y",
          "description": "Default field name to use as y-axis data",
          "type": "string"
        },
        "x_label": {
          "title": "X Label",
          "description": "Default label for the x-axis",
          "type": "string"
        },
        "y_label": {
          "title": "Y Label",
          "description": "Default label for the y-axis",
          "type": "string"
        },
        "title": {
          "title": "Title",
          "description": "Default plot title",
          "type": "string"
        },
        "header": {
          "title": "Header",
          "description": "Whether the target CSV or TSV has a header or not",
          "default": false,
          "type": "boolean"
        },
        "template": {
          "title": "Template",
          "description": "Default plot template",
          "type": "string"
        },
        "summary": {
          "title": "Summary",
          "description": "Signals dvclive to dump latest metrics file",
          "default": true,
          "type": "boolean"
        },
        "html": {
          "title": "Html",
          "description": "Signals dvclive to produce training report",
          "default": true,
          "type": "boolean"
        }
      },
      "additionalProperties": false
    },
    "Live": {
      "title": "Live",
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/LiveFlags"
      },
      "maxProperties": 1
    },
    "Stage": {
      "title": "Stage",
      "description": "A named stage of a pipeline.",
      "type": "object",
      "properties": {
        "cmd": {
          "title": "Cmd",
          "description": "(Required) Command to run (anything your system terminal can run).\n\nCan be a string or a sequence of commands.",
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          ]
        },
        "wdir": {
          "title": "Wdir",
          "description": "Working directory for the cmd, relative to `dvc.yaml`",
          "type": "string"
        },
        "deps": {
          "title": "Deps",
          "description": "Sequence of the dependencies for the stage.",
          "allOf": [
            {
              "$ref": "#/definitions/Dependencies"
            }
          ]
        },
        "params": {
          "title": "Params",
          "description": "Sequence of dot-separated parameter dependency keys to track from `params.yaml`.\n\nMay contain other YAML/JSON/TOML/Python parameter file names, with a sub-sequence of the param names to track in them (leave empty to include all).",
          "allOf": [
            {
              "$ref": "#/definitions/Params"
            }
          ]
        },
        "outs": {
          "title": "Outs",
          "description": "Sequence of the outputs of the stage.",
          "allOf": [
            {
              "$ref": "#/definitions/Outs"
            }
          ]
        },
        "metrics": {
          "title": "Metrics",
          "description": "Sequence of metrics of the stage written to JSON/TOML/YAML for evaluation.",
          "allOf": [
            {
              "$ref": "#/definitions/Outs"
            }
          ]
        },
        "plots": {
          "title": "Plots",
          "description": "Sequence of plots of the stage for visualization.\n\nPlots may be written to JSON/YAML/CSV/TSV for data or JPEG/GIF/PNG for images.",
          "allOf": [
            {
              "$ref": "#/definitions/Plots"
            }
          ]
        },
        "live": {
          "title": "Dvclive",
          "description": "Declare output as dvclive",
          "allOf": [
            {
              "$ref": "#/definitions/Live"
            }
          ]
        },
        "frozen": {
          "title": "Frozen",
          "description": "Assume stage as unchanged",
          "default": false,
          "type": "boolean"
        },
        "always_changed": {
          "title": "Always Changed",
          "description": "Assume stage as always changed",
          "default": false,
          "type": "boolean"
        },
        "vars": {
          "title": "Vars",
          "description": "Sequence of variables for parametrization.\n\nMay include any mapping or a path to a params file (which may be a string or a mapping to params in the file).\n\nUse in the stage with the `${}` substitution expression.",
          "allOf": [
            {
              "$ref": "#/definitions/Vars"
            }
          ]
        },
        "desc": {
          "title": "Desc",
          "description": "Description of the stage",
          "type": "string"
        },
        "meta": {
          "title": "Meta",
          "description": "Additional information/metadata"
        }
      },
      "required": [
        "cmd"
      ],
      "additionalProperties": false
    },
    "ForeachDo": {
      "title": "ForeachDo",
      "type": "object",
      "properties": {
        "foreach": {
          "title": "Foreach",
          "description": "Iterable to loop through in foreach. Can be a parametrized string, sequence or a mapping.\n\nThe stages will be generated by iterating through this data, by substituting data in the `do` block.",
          "anyOf": [
            {
              "type": "string",
              "pattern": "^\\${.*?}$"
            },
            {
              "type": "array",
              "items": {}
            },
            {
              "type": "object"
            }
          ]
        },
        "do": {
          "title": "Do",
          "description": "Parametrized stage definition that'll be substituted over for each of the value from the foreach data.",
          "allOf": [
            {
              "$ref": "#/definitions/Stage"
            }
          ]
        }
      },
      "required": [
        "foreach",
        "do"
      ],
      "additionalProperties": false
    }
  }
}
